<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Webit Script  by zqq90</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Webit Script </h1>
        <h2>A template-like script and engine, all writen with Java 5+.</h2>
        <a href="https://github.com/zqq90/webit-script" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a name="webit-script----to-be-awesome" class="anchor" href="#webit-script----to-be-awesome"><span class="octicon octicon-link"></span></a>Webit Script -- to be awesome</h1>

<p>A template-like script and engine, all writen with Java <strong>(Java 5+)</strong>.</p>

<p>It's grammar is very like Javascript, and with <code>&lt;% %&gt;</code> <code>${ }</code> like in JSP</p>

<p><strong>Download: <a href="http://zqq90.github.io/maven/com/github/zqq90/webit-script/webit-script/1.1.0/webit-script-1.1.0.jar">Jar</a>    <a href="http://zqq90.github.io/maven/com/github/zqq90/webit-script/webit-script/1.1.0/webit-script-1.1.0-javadoc.jar">Javadoc</a>    <a href="http://zqq90.github.io/maven/com/github/zqq90/webit-script/webit-script/1.1.0/webit-script-1.1.0-sources.jar">Sources</a></strong></p>

<h2>
<a name="how-to-use%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8" class="anchor" href="#how-to-use%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8"><span class="octicon octicon-link"></span></a>How to use(如何使用)</h2>

<h3>
<a name="maven" class="anchor" href="#maven"><span class="octicon octicon-link"></span></a>Maven</h3>

<pre><code>    &lt;repositories&gt;
        &lt;repository&gt;
            &lt;id&gt;webit-script&lt;/id&gt;
            &lt;name&gt;Webit script&lt;/name&gt;
            &lt;url&gt;http://zqq90.github.io/maven/&lt;/url&gt;
        &lt;/repository&gt;
    &lt;/repositories&gt;
    &lt;dependencies&gt;
        ...
        &lt;dependency&gt;
            &lt;groupId&gt;com.github.zqq90.webit-script&lt;/groupId&gt;
            &lt;artifactId&gt;webit-script&lt;/artifactId&gt;
            &lt;version&gt;1.1.0&lt;/version&gt;
        &lt;/dependency&gt;
        ...
    &lt;/dependencies&gt;
</code></pre>

<h3>
<a name="or-add-jars" class="anchor" href="#or-add-jars"><span class="octicon octicon-link"></span></a>Or Add jars</h3>

<ul>
<li><code>webit-script-[version].jar</code></li>
<li><code>jodd-core-[version].jar</code></li>
<li><code>jodd-props-[version].jar</code></li>
</ul><h3>
<a name="or-jodd-inside-version" class="anchor" href="#or-jodd-inside-version"><span class="octicon octicon-link"></span></a>Or jodd-inside Version</h3>

<pre><code>    &lt;dependency&gt;
        &lt;groupId&gt;com.github.zqq90.webit-script&lt;/groupId&gt;
        &lt;artifactId&gt;webit-script-joddinside&lt;/artifactId&gt;
        &lt;version&gt;1.1.0&lt;/version&gt;
    &lt;/dependency&gt;
</code></pre>

<ul>
<li><code>webit-script-joddinside-[version].jar</code></li>
<li><em>我们非常推荐您尝试一下Jodd, 但如果您真的不打算直接使用Jodd, 并且您的项目没直接使用或间接引用到Jodd, 可以试试这个</em></li>
</ul><h3>
<a name="about-release" class="anchor" href="#about-release"><span class="octicon octicon-link"></span></a>About Release</h3>

<ul>
<li><em>current version 1.1.0</em></li>
<li><a href="http://zqq90.github.io/maven/com/github/zqq90/webit-script/webit-script-joddinside/1.1.0/webit-script-joddinside-1.1.0.jar">webit-script-joddinside-1.1.0.jar</a></li>
<li>Jodd here: <a href="http://jodd.org/download/index.html">Download</a>   <a href="http://jodd.org/index.html">Site</a>   <a href="http://jodd.org/doc/index.html">Doc</a>   <a href="https://github.com/oblac/jodd">Github</a>
</li>
</ul><h3>
<a name="code-in-java-like-this" class="anchor" href="#code-in-java-like-this"><span class="octicon octicon-link"></span></a>Code in Java like this</h3>

<pre><code>    // !! engine 并不会被缓存, 请根据需要自行实现 Engine的单例模式
    Engine engine = Engine.createEngine("/webit-script-config.props", extraSettingsMap);

    ....
    // template 已缓存, 线程安全, 并自动检测模板源是否被更新
    // 当然您也可以缓存 Template 实例，模板更新时更新实例内部AST, 其实例不会变化
    Template template = engine.getTemplate("/your/template/path/filename.ext");
    ...

    template.merge(parametersMap, outputStream); 
    //template.merge(parametersMap, writer);
</code></pre>

<h2>
<a name="config%E9%85%8D%E7%BD%AE" class="anchor" href="#config%E9%85%8D%E7%BD%AE"><span class="octicon octicon-link"></span></a>Config(配置)</h2>

<ul>
<li>配置文件格式: Use Jodd-props, see:<a href="http://jodd.org/doc/props.html">Jodd Props doc</a>
<code>Tips: Java-Properties also works</code>
</li>
<li><del>匹配支持  "/webit-script-*.props</del></li>
<li>多文件支持 "/webit-script-config1.props,/webit-script-config2.props"</li>
<li>可选额外参数: extraSettingsMap 类型为Map, 支持props 宏</li>
<li>默认配置: <a href="https://github.com/zqq90/webit-script/blob/master/webit-script/src/main/resources/webitl-default.props">webitl-default.props</a>
</li>
</ul><h2>
<a name="grammar%E8%AF%AD%E6%B3%95" class="anchor" href="#grammar%E8%AF%AD%E6%B3%95"><span class="octicon octicon-link"></span></a>Grammar(语法)</h2>

<h3>
<a name="hello-word" class="anchor" href="#hello-word"><span class="octicon octicon-link"></span></a>Hello word</h3>

<pre><code>Hello ${"world"}
</code></pre>

<p>更复杂点儿的</p>

<pre><code>&lt;%
var books; //List
{
    for(book : books){
        //for.iter:  index  hasNext next isFast isEven isOdd
%&gt;${for.iter.index}. ${book.name}:${book.price} ${for.iter.hasNext?null,"\n\n"}
&lt;%
    }
}
{
    //this is a function
    var func =function(a, b){
        return a + b + arguments[3];
    };
    echo func("a", "b", "c");
    echo '\n';
}
{
    var map = {
        1:1,
        "key2":"value2",
        3: 2+1
    };

    map[5] = 2+3;

    var x;
    x = map[3];
    x = map["key2"];
    x = map.key2; //不推荐的写法
    //x = map.3; //错误的写法 

    for(key, value : map){
        //同样有 for.iter
        echo key + ":" +value + "\n";
    }
}
%&gt;
</code></pre>

<p>更多实例可见:<a href="https://github.com/zqq90/webit-script/tree/master/webit-script/src/test/resources/webit/script/test/tmpls">测试模板</a></p>

<h3>
<a name="%E7%BB%93%E6%9E%84" class="anchor" href="#%E7%BB%93%E6%9E%84"><span class="octicon octicon-link"></span></a>结构</h3>

<ul>
<li>脚本必须都放在<code>&lt;% %&gt;</code> 内. <code>&lt;% .code inside.. %&gt; plain text outside</code>
</li>
<li>替换占位符<code>${}</code> 只能允许带返回值的单个表达式,只能在脚本块<code>&lt;% %&gt;</code> 以外使用.<code>${ .. expression .. }</code> </li>
<li>转义字符 <code>\\</code> to <code>\</code> , <code>\&lt;%</code> to <code>&lt;%</code>, <code>\${</code> to <code>${</code>
</li>
<li>Node: 只有紧挨 <code>&lt;%</code> <code>${</code> 的 <code>\</code> 才需要转义 , </li>
<li>转义窍门: 偶数个 <code>\</code> 会 打印 一半数量的<code>\</code> 并进入代码段, 
        奇数 会 打印 (count-1)/2 个 <code>\</code> 然后打印被转移的符号。</li>
</ul><h3>
<a name="%E6%B3%A8%E9%87%8A" class="anchor" href="#%E6%B3%A8%E9%87%8A"><span class="octicon octicon-link"></span></a>注释</h3>

<ul>
<li>单行注释 <code>//</code> </li>
<li>块注释 <code>/* */</code> </li>
</ul><h3>
<a name="%E5%85%B3%E9%94%AE%E5%AD%97" class="anchor" href="#%E5%85%B3%E9%94%AE%E5%AD%97"><span class="octicon octicon-link"></span></a>关键字</h3>

<pre><code>    var  super  this
    if  else
    switch  case  default
    for  do  while  break  continue 
    function  return
    import  include  echo
    native  new  @import
</code></pre>

<h3>
<a name="%E4%BF%9D%E7%95%99%E7%9A%84%E5%85%B3%E9%94%AE%E5%AD%97" class="anchor" href="#%E4%BF%9D%E7%95%99%E7%9A%84%E5%85%B3%E9%94%AE%E5%AD%97"><span class="octicon octicon-link"></span></a>保留的关键字</h3>

<pre><code>    static  instanceof  class  const  final
    throw  try  catch  finally
</code></pre>

<h3>
<a name="%E6%93%8D%E4%BD%9C%E7%AC%A6" class="anchor" href="#%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="octicon octicon-link"></span></a>操作符</h3>

<p><em>与Java 保持一致，顺序按优先级从高到低</em></p>

<pre><code>  []  .  ()  @ (新增)
  =&gt; (新增,重定向输出)
  !  ~  ++  --  – (取负)
  *  /  %
  +  -
  &lt;&lt;  &gt;&gt;  &gt;&gt;&gt;
  &lt;  &lt;=  &gt;  &gt;=
  ^
  |
  &amp;&amp;
  ||
  ? : (三元条件运算符)   ?: (新增: 二元操作符)
  .. (新增: 递增[减]操作符)
  =  +=  -=  *=  /=  %=  ^=  &lt;&lt;=  &gt;&gt;=  &gt;&gt;&gt;=
</code></pre>

<h3>
<a name="%E8%AF%AD%E5%8F%A5" class="anchor" href="#%E8%AF%AD%E5%8F%A5"><span class="octicon octicon-link"></span></a>语句</h3>

<ul>
<li>结尾分号不能省略</li>
</ul><h3>
<a name="%E4%BD%9C%E7%94%A8%E5%9F%9F-%E4%BB%A3%E7%A0%81%E6%AE%B5-" class="anchor" href="#%E4%BD%9C%E7%94%A8%E5%9F%9F-%E4%BB%A3%E7%A0%81%E6%AE%B5-"><span class="octicon octicon-link"></span></a>作用域 (代码段) {}</h3>

<ul>
<li>作用域引用上层变量</li>
<li>本层作用域变量不会影响上层</li>
<li>同一作用域不能重复声明变量</li>
<li><strong>模板传入的变量仅在该作用域查找同名变量并赋值</strong></li>
</ul><p><em>1. 调用模板传入的变量; 2.import 返回的变量</em></p>

<h3>
<a name="%E5%8F%98%E9%87%8F" class="anchor" href="#%E5%8F%98%E9%87%8F"><span class="octicon octicon-link"></span></a>变量</h3>

<h4>
<a name="%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E-var" class="anchor" href="#%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E-var"><span class="octicon octicon-link"></span></a>变量声明 var</h4>

<pre><code>var a;
var a, b, c=0, d="d";
</code></pre>

<h4>
<a name="%E5%8F%98%E9%87%8F%E5%90%8D%E8%A7%84%E5%88%99" class="anchor" href="#%E5%8F%98%E9%87%8F%E5%90%8D%E8%A7%84%E5%88%99"><span class="octicon octicon-link"></span></a>变量名规则</h4>

<ul>
<li>先声明 后使用，所有变量 必须全部声明</li>
<li>可开启 弱声明模式，所有变量不需要 事先声明，解析时自动声明</li>
<li>对大小写敏感</li>
<li>不能使用关键字</li>
<li>仅能包含 0-9a-zA-Z_$</li>
<li>特殊变量名: 
++ super. 用于 取得指定上层且仅该层作用域的变量, 可嵌套<code>super.super.a</code>
++ this. 用于 取得本层且仅本层作用域的变量, 可嵌套<code>this.this.a</code>
++ for.iter 用于 最近一层for循环的 迭代状态对象, 可使用"super" "this" 限定作用域</li>
</ul><h3>
<a name="%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84" class="anchor" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="octicon octicon-link"></span></a>数据结构</h3>

<h4>
<a name="%E6%8B%A5%E6%9C%89%E5%8A%A8%E6%80%81%E7%B1%BB" class="anchor" href="#%E6%8B%A5%E6%9C%89%E5%8A%A8%E6%80%81%E7%B1%BB"><span class="octicon octicon-link"></span></a>拥有动态类</h4>

<pre><code>var x                             //  null
var x2 = 6;                    //  数字
var x3 = "Bill";               //  字符串
var x4 = 'a';                   //  字符
var x5 = [1, "string"];     //  数组
var x6 = {};                    // Map
</code></pre>

<h4>
<a name="%E5%AD%97%E7%AC%A6%E4%B8%B2" class="anchor" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="octicon octicon-link"></span></a>字符串</h4>

<ul>
<li>转义，<code>\\</code> <code>\"</code> <code>\'</code> <code>\n</code> <code>\r</code> <code>\t</code> <code>\f</code> <code>\b</code>
</li>
<li>允许换行，行后转义字符 可屏蔽该换行符</li>
</ul><pre><code>var string = "第一行  \
这还是在第一行
这是第二行\n第三行\n
这是第五行，第四行是空行"；
</code></pre>

<h3>
<a name="%E6%95%B0%E5%AD%97" class="anchor" href="#%E6%95%B0%E5%AD%97"><span class="octicon octicon-link"></span></a>数字</h3>

<pre><code>var x1=34;  //Integer
var x2=34L;  //Long
var x3=34.00; //Double
var x4=34.00D;  //Double
var x5=34.00F;  //Float

var x6 = 0b10101;  //二进制
var x7 = 0123; //八进制
var x8 = 0x1A; //十六进制
</code></pre>

<h3>
<a name="%E5%B8%83%E5%B0%94" class="anchor" href="#%E5%B8%83%E5%B0%94"><span class="octicon octicon-link"></span></a>布尔</h3>

<pre><code>var x=true;
var y=false;
</code></pre>

<h3>
<a name="%E6%95%B0%E7%BB%84" class="anchor" href="#%E6%95%B0%E7%BB%84"><span class="octicon octicon-link"></span></a>数组</h3>

<h4>
<a name="%E5%B8%A6%E5%88%9D%E5%A7%8B%E5%80%BC%E7%9A%84%E6%95%B0%E7%BB%84" class="anchor" href="#%E5%B8%A6%E5%88%9D%E5%A7%8B%E5%80%BC%E7%9A%84%E6%95%B0%E7%BB%84"><span class="octicon octicon-link"></span></a>带初始值的数组</h4>

<pre><code>var array = [1, "a string", book];
var item;
item = array[0];
item = array[1];
item = array[2];

array[0] = "a new value"；
</code></pre>

<h4>
<a name="native-%E6%96%B9%E6%B3%95%E5%A3%B0%E6%98%8E%E5%AE%9A%E9%95%BF%E6%95%B0%E7%BB%84" class="anchor" href="#native-%E6%96%B9%E6%B3%95%E5%A3%B0%E6%98%8E%E5%AE%9A%E9%95%BF%E6%95%B0%E7%BB%84"><span class="octicon octicon-link"></span></a>Native 方法声明定长数组,</h4>

<pre><code>// 引入生成数组的 native 方法
var new_int_array = native [int];
var new_Object_array = native [Object];
var new_DateTime_array = native [java.util.DateTime];

//得到定长数组
var int_array = new_int_array(5); //长度为5 的int数组
var objects = new_Object_array(5);//长度为5 的Object数组

var a;
a = objects[4];
objects[4]=4; // 自动 装箱为Integer 然后放入数组
var len = objects.length; //数组长度
len = objects.size; //数组长度

//不定长数组 可使用Java提供的List实现
var new_list = native new java.util.ArrayList();
var list_add = native java.util.List.add(Object);

var list = new_list();
list@list_add(0); 
list@list_add(1);

var a = list[0];
list[0] = "zero";
list[1] = "a string";
</code></pre>

<h3>
<a name="map" class="anchor" href="#map"><span class="octicon octicon-link"></span></a>Map</h3>

<pre><code>var map = {};
var map2 = {1:1,"2","2"};
map["key"] = "a string value";

var value = map[1];
value = map["2"];
value = map["key"];
</code></pre>

<h3>
<a name="java%E5%AF%B9%E8%B1%A1" class="anchor" href="#java%E5%AF%B9%E8%B1%A1"><span class="octicon octicon-link"></span></a>Java对象</h3>

<h4>
<a name="%E5%A3%B0%E6%98%8E" class="anchor" href="#%E5%A3%B0%E6%98%8E"><span class="octicon octicon-link"></span></a>声明</h4>

<pre><code>var new_list = native new java.util.ArrayList();
var list = new_list();
var list2 = new_list();
</code></pre>

<h4>
<a name="%E8%AE%BF%E9%97%AE%E5%B1%9E%E6%80%A7" class="anchor" href="#%E8%AE%BF%E9%97%AE%E5%B1%9E%E6%80%A7"><span class="octicon octicon-link"></span></a>访问属性</h4>

<pre><code>var book;
var name = book.name; // book.getName();
book.name = "new name"; //book.setName("new name"); 
</code></pre>

<h4>
<a name="%E8%AE%BF%E9%97%AE%E6%96%B9%E6%B3%95" class="anchor" href="#%E8%AE%BF%E9%97%AE%E6%96%B9%E6%B3%95"><span class="octicon octicon-link"></span></a>访问方法</h4>

<p><em>访问方法必须事先native导入成本地函数</em></p>

<pre><code>var list_add = native java.util.List.add(Object);

list@list_add(0);
list_add(list, 1);
</code></pre>

<p><em>访问静态方法</em></p>

<pre><code>var now = native java.lang.System.currentTimeMillis();
echo now();
</code></pre>

<h3>
<a name="%E5%87%BD%E6%95%B0" class="anchor" href="#%E5%87%BD%E6%95%B0"><span class="octicon octicon-link"></span></a>函数</h3>

<h4>
<a name="%E5%A3%B0%E6%98%8E-1" class="anchor" href="#%E5%A3%B0%E6%98%8E-1"><span class="octicon octicon-link"></span></a>声明</h4>

<ul>
<li>格式同java</li>
<li>可变参数, </li>
<li>可通过 arguments 获得所有传入的参数, java类型为 Object[]</li>
<li>可访问父层作用域</li>
<li>函数内部可嵌套函数</li>
</ul><pre><code>var outSideVar;
var a;

var myFunc = function(arg1, arg2){
    var arg3 = arguments[3]; // 如果没有将抛出异常,最好通过 arguments.size确认
    outSideVar = "a new "; //可访问
    var a = 0; //内部变量
    super.a ++ ; //访问上层变量
    var func = function(){ ... }; //内部嵌套函数
}; //不要忘了分号！！！
</code></pre>

<h4>
<a name="%E5%AF%BC%E5%85%A5java%E5%86%85%E7%9A%84-%E6%96%B9%E6%B3%95" class="anchor" href="#%E5%AF%BC%E5%85%A5java%E5%86%85%E7%9A%84-%E6%96%B9%E6%B3%95"><span class="octicon octicon-link"></span></a>导入Java内的 方法</h4>

<ul>
<li>仅可导入公共类的公共方法, 包括静态方法 和 成员方法</li>
<li>可使用<code>@import</code> 导入类名 或者包名 用法同Java里的 <code>import</code>, 以简化输入</li>
</ul><pre><code>@import  java.lang.System; //实际上默认已经导入  java.lang.* 只是掩饰使用方法
@import  java.util.*;
var now = native java.lang.System.currentTimeMillis();
var list_add = native List.add(Object);
var new_list = native new add(Object); // 导入 构造函数
</code></pre>

<h3>
<a name="%E8%B0%83%E7%94%A8" class="anchor" href="#%E8%B0%83%E7%94%A8"><span class="octicon octicon-link"></span></a>调用</h3>

<ul>
<li>可变参数个数, 多余函数同样会被传入, 多余函数是否被使用 取决于函数本身</li>
<li>缺少的参数 自动 null 填充, <em>为了良好的设计 不建议使用缺少函数自动填充</em>
</li>
<li>可使用@ 将第一个参数 外置</li>
</ul><pre><code>func(arg1, arg2);
//等同于
arg1 @ func(arg2);

list_add(list, item);
//等同于
list@list_add(item);
</code></pre>

<h3>
<a name="%E9%87%8D%E5%AE%9A%E5%90%91%E8%BE%93%E5%87%BA%E7%AC%A6-" class="anchor" href="#%E9%87%8D%E5%AE%9A%E5%90%91%E8%BE%93%E5%87%BA%E7%AC%A6-"><span class="octicon octicon-link"></span></a>重定向输出符 <code>=&gt;</code>
</h3>

<ul>
<li>作用: 将指定 范围 产生的输出流 重定向到 指定变量</li>
<li>意义: 可以延后输出</li>
<li><strong>使用对象: 1. 代码段；  2. 函数调用</strong></li>
<li>数据格式: 使用OutputStream 时, 为 byte[] ; 使用 Writer 时, 为String.</li>
</ul><pre><code>var out;
var book;

//代码段 输出重定向
{
echo "a String";
&gt;${book.name} &lt;
} =&gt; out; //不要忘了分号！！！
// "a String" 以及 book.name 都将输出到 out
</code></pre>

<pre><code>var out;
// 函数 输出重定向
func() =&gt; out;
//由于 `=&gt;` 具有较高的优先级，也可以这么些
var a = arg1@func() =&gt; out +1; 
//此时 a为 func()+1 , func() 本次执行的输出内容赋值给out
</code></pre>

<h3>
<a name="import--include" class="anchor" href="#import--include"><span class="octicon octicon-link"></span></a>import &amp; include</h3>

<ul>
<li>区别: import  将把调用模板的 上层变量 推入调用层的当前已存在变量</li>
<li>共同点: 都会在调用位置产生 输出</li>
<li>将使用默认的Loader 加载模板，可使用相对路径或绝对路径</li>
<li>可跟随 一个 map 格式的传参</li>
<li>模板名可以动态生成</li>
<li>import 可支持指定需要导出的变量, 否则只导出本层作用域内的同名变量</li>
</ul><pre><code>//相对路径
include "./book-head.wtl";
//等同于 
include "book-head.wtl";

//绝对路径
include "/copyright.wtl";

//动态模板名
var style = "";
import "book-list-"+ style  +".wtl";

//可传入参数 函数同样也可以作为变量传输
var func = function(){}; 
var book;
import "book-head.wtl"  {"book": book, "func":func};

//传入Map 变量作为参数
var map =  {"book": book, "func":func}；
map["one"] = 1; 
import "book-head.wtl"  {map};

//导出指定变量
var a;
var b;
//导出 : a 到a ，c 到 b
import "book-head.wtl"  {"param1":1}  a,b=c;

</code></pre>

<h3>
<a name="%E5%85%B3%E4%BA%8E%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E7%9A%84%E4%B8%89%E7%A7%8D%E6%83%85%E5%86%B5" class="anchor" href="#%E5%85%B3%E4%BA%8E%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E7%9A%84%E4%B8%89%E7%A7%8D%E6%83%85%E5%86%B5"><span class="octicon octicon-link"></span></a>关于条件判断的三种情况</h3>

<ul>
<li>如果是boolean(Boolean)值 会原封返回</li>
<li><strong>如果 ==null 返回 false</strong></li>
<li>**如果 是空集合 或者 空数组 (.size==0)  返回 false **</li>
<li>否则 返回 true</li>
</ul><h3>
<a name="%E4%B8%89%E5%85%83%E6%9D%A1%E4%BB%B6%E8%BF%90%E7%AE%97%E7%AC%A6--%E5%85%B6%E7%AE%80%E5%86%99" class="anchor" href="#%E4%B8%89%E5%85%83%E6%9D%A1%E4%BB%B6%E8%BF%90%E7%AE%97%E7%AC%A6--%E5%85%B6%E7%AE%80%E5%86%99"><span class="octicon octicon-link"></span></a>三元条件运算符 &amp; 其简写</h3>

<ul>
<li><strong>操作符按 自右向左 结合 [不是执行顺序], 详解看下面例子</strong></li>
<li><strong>简写时 <code>?:</code> 之间不能有空白</strong></li>
</ul><pre><code>var a1 = isTrue ? "Yes" : "No";

//简写
var a2 = value ?: defaultValue; //取默认值
// 在不严格意义上相当于 value ?  value  : defaultValue
// 如果 value 是个表达式什么的(例如包含 ++ -- 或者 .next()), 
// 我想你知道为什么说是"不严格意义上"

var a3 = list1 ?: list2;  // list1为空时 取 list2, !当然 list2是否为空什么的
var a4 = list1 ?: list2 ?: list3; // 这样 就判断 list2 了, list3 就是终极defaultValue


//自右向左 结合

//这里很重要！相信你能搞明白！
var x =  expr1 ?  expr3 :  expr2 ? expr4 : expr5;
//这个等同于
var x =  expr1 ?  expr3 :  (expr2 ? expr4 : expr5);
// 如果 是 自左向右 就会变成这样
var x =  (expr1 ?  expr3 :  expr2) ? expr4 : expr5;
// 这么看 结果 肯定有出入了吧，
//前者 候选人 expr3 expr4 expr5； 评委 expr1  expr2
//后者 候选人 expr4 expr5；评委 expr1 expr3 expr2
//PS: 后者 expr1 就是传说中的"V神" 啊有木有，前者的 expr2 顶多是 吃expr1 剩下的, 话说高考的话 第二志愿能录取 也不错，总比被V了好

//来个更复杂的
var x =  expr1 ?  expr3? expr6 : expr7 :  expr2 ? expr4 : expr5;
// 自右向左 结合
var x = expr1 ?  (expr3? expr6 : expr7) :  (expr2 ? expr4 : expr5);
// 自左向右 结合
var x = (expr1 ? (expr3 ? expr6 : expr7) :  expr2) ? expr4 : expr5;
// What?  java里要求 expr1 expr3  expr6 expr7 expr2 都是 boolean(评委) ??!! java里不会出现这么变态的结合吧? 一堆boolean 用 ?: 有意义么？
//是的 这下就明白了后者 真是 天外有天 V神中的V神, 评委海选选拔赛, 括弧笑


//简写这个 你就按 从左向右 “执行”  别管结合性了
var a4 = list1 ?: list2 ?: list3;
</code></pre>

<h3>
<a name="%E5%88%A4%E6%96%AD%E8%AF%AD%E5%8F%A5" class="anchor" href="#%E5%88%A4%E6%96%AD%E8%AF%AD%E5%8F%A5"><span class="octicon octicon-link"></span></a>判断语句</h3>

<h4>
<a name="%E5%88%A4%E6%96%AD%E8%A1%A8%E8%BE%BE%E5%BC%8F-" class="anchor" href="#%E5%88%A4%E6%96%AD%E8%A1%A8%E8%BE%BE%E5%BC%8F-"><span class="octicon octicon-link"></span></a>判断表达式 ?:</h4>

<h4>
<a name="%E5%88%A4%E6%96%AD%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5-if---else-if---else" class="anchor" href="#%E5%88%A4%E6%96%AD%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5-if---else-if---else"><span class="octicon octicon-link"></span></a>判断控制语句 if - else if - else</h4>

<ul>
<li>不能省略 <code>{  }</code>
</li>
</ul><pre><code>if( ... ){
...;
}else if(...){
...;
}else{
...;
}
</code></pre>

<h3>
<a name="%E5%BE%AA%E7%8E%AF%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5" class="anchor" href="#%E5%BE%AA%E7%8E%AF%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5"><span class="octicon octicon-link"></span></a>循环控制语句</h3>

<ul>
<li>支持 数组,  java.util.Collection, java.util.Iterator, java.util.Enumeration, CharSequence, java.util.Map, 整型递增/递减</li>
<li>当集合为null 或者为空时将不会执行循环</li>
<li>支持 else , 可选, 当不符合执行循环体的条件时执行else体.
#### for-in</li>
</ul><pre><code>//集合 数组 等
for(item : list){
    echo item;
    //echo for.iter.index; // .isFirst .hasNext .isOdd .isEven
} else{
    echo "list is empty";
}

//递增 
for(i: 3..6){
    echo i;
}

//递减
for(i: 6..3){
    echo i;
    //支持 for.iter.*
}
</code></pre>

<h4>
<a name="for-in-map-version" class="anchor" href="#for-in-map-version"><span class="octicon octicon-link"></span></a>for-in Map version</h4>

<pre><code>for(key, value : map){
    echo key + " = " value;
    echo "\n";
    //同样支持 for.iter.*
}
</code></pre>

<h4>
<a name="while-do-while" class="anchor" href="#while-do-while"><span class="octicon octicon-link"></span></a>while do-while</h4>

<ul>
<li>不支持 for.iter 特殊变量</li>
</ul><pre><code>//
var iter;
... ;
while(iter.hasNext){
    var item = iter.next;
    ....;
}

//
do{
    ....;
}while( ... );

</code></pre>

<h3>
<a name="switch-case" class="anchor" href="#switch-case"><span class="octicon octicon-link"></span></a>Switch-Case</h3>

<ul>
<li>支持普通 Object, 包括 String </li>
<li>使用  Object.equls() 判断是否相等</li>
<li>需要 break, 否则无条件继续执行下一个标签的句柄</li>
<li>每个case 命名空间独立</li>
</ul><pre><code>switch(a){
    case 1:
        ....;
        break;
    case "c": //String
        ....;
        break;
    case 'c': //Char
        ....;
        break;
    default:
        ....;
}
</code></pre>

<h3>
<a name="break-continue" class="anchor" href="#break-continue"><span class="octicon octicon-link"></span></a>break continue</h3>

<ul>
<li><strong>支持 label, 直接操作该循环体 或 switch</strong></li>
</ul><pre><code>//break continue
outter: for(i: 6..3){
    echo i;
    //支持 for.iter.*
    inner: for(item : list){
        if( ..... ){
           break outter;
        }
        .....;
        break; // break inner;
    }

    //
    switch(a){
        ...;
        case 'x':
           break outter;
        ...;
    }
}
</code></pre>

<h3>
<a name="%E6%AD%A3%E5%9C%A8%E5%AE%8C%E5%96%84" class="anchor" href="#%E6%AD%A3%E5%9C%A8%E5%AE%8C%E5%96%84"><span class="octicon octicon-link"></span></a>正在完善。。。</h3>

<h3>
<a name="%E5%85%B6%E4%BB%96" class="anchor" href="#%E5%85%B6%E4%BB%96"><span class="octicon octicon-link"></span></a>其他</h3>

<h2>
<a name="%E6%80%A7%E8%83%BD" class="anchor" href="#%E6%80%A7%E8%83%BD"><span class="octicon octicon-link"></span></a>性能</h2>

<ul>
<li>缺省开启ASM构建Native 调用减少反射, 不同于将整个模板编译成Java字节码,该方法不会造成无限制的perm溢出;</li>
<li>解析之后的Template AST会放入缓存, 检测到模板源文件改变时将重新加载资源并解析;</li>
<li>性能测试结果比较理想, 待比较权威的模版测试程序;</li>
<li><p>使用OutputStream 输出时, 选择 SimpleTextStatmentFactory 将会预先将纯文本根据缺省编码编码成字节流. </p></li>
<li><p>HTTL BenchmarkTest 的测试结果</p></li>
</ul><p>OutputStream:</p>

<pre><code>====================test environment=====================
os: Windows 7 6.1 x86, cpu: 2 cores, jvm: 1.7.0_17, 
mem: max: 247M, total: 21M, free: 9M, use: 12M
====================test parameters======================
count: 10000, warm: 100, list: 30, stream: true,
engines: java,httl,webitScript,velocity
====================test result==========================
     engine, version,    time,     tps, rate,
       java,1.7.0_17,  2700ms,  3703/s, 100%,
       httl,  1.0.10,  1592ms,  6281/s, 169%,
webitscript,   1.0.0,  2004ms,  4990/s, 134%,
   velocity,     1.7,  5022ms,  1991/s,  53%,
=========================================================
====================test environment=====================
os: Windows 7 6.1 x86, cpu: 2 cores, jvm: 1.6.0_37, 
mem: max: 247M, total: 15M, free: 4M, use: 11M
====================test parameters======================
count: 10000, warm: 100, list: 30, stream: true,
engines: java,httl,webitScript,velocity
====================test result==========================
     engine, version,    time,     tps, rate,
       java,1.6.0_37,  2620ms,  3816/s, 100%,
       httl,  1.0.10,  1542ms,  6485/s, 169%,
webitscript,   1.0.0,  2292ms,  4363/s, 114%,
   velocity,     1.7,  5102ms,  1960/s,  51%,
=========================================================
</code></pre>

<p>Writer:</p>

<pre><code>====================test environment=====================
os: Windows 7 6.1 x86, cpu: 2 cores, jvm: 1.6.0_37, 
mem: max: 455M, total: 122M, free: 108M, use: 14M
====================test parameters======================
count: 10000, warm: 100, list: 30, stream: false,
engines: java,httl,webitScript,velocity
====================test result==========================
     engine, version,    time,     tps, rate,
       java,1.6.0_37,  1273ms,  7855/s, 100%,
       httl,  1.0.10,   700ms, 14285/s, 181%,
webitscript,   1.0.0,  1240ms,  8064/s, 102%,
   velocity,     1.7,  2028ms,  4930/s,  62%,
=========================================================

====================test environment=====================
os: Windows 7 6.1 x86, cpu: 2 cores, jvm: 1.7.0_17, 
mem: max: 455M, total: 122M, free: 90M, use: 32M
====================test parameters======================
count: 10000, warm: 100, list: 30, stream: false,
engines: java,httl,webitScript,velocity
====================test result==========================
     engine, version,    time,     tps, rate,
       java,1.7.0_17,  1124ms,  8896/s, 100%,
       httl,  1.0.10,   684ms, 14619/s, 164%,
webitscript,   1.0.0,  1219ms,  8203/s,  92%,
   velocity,     1.7,  1941ms,  5151/s,  57%,
=========================================================

</code></pre>

<h2>
<a name="spi" class="anchor" href="#spi"><span class="octicon octicon-link"></span></a>SPI</h2>

<ul>
<li>TextStatmentFactory  对模板纯文本的存贮以及输出形式进行管理</li>
<li>Filter   输出过滤</li>
<li>CoderFactory   编码/解码</li>
<li>Loader   模板资源加载(原ResourceLoader)</li>
<li>Logger   日志</li>
<li>GetResolver, SetResolver, OutResolver  Bean属性解释器</li>
<li>NativeSecurityManager   Native调用安全管理器</li>
</ul><h2>
<a name="requirements%E4%BE%9D%E8%B5%96" class="anchor" href="#requirements%E4%BE%9D%E8%B5%96"><span class="octicon octicon-link"></span></a>Requirements(依赖)</h2>

<ul>
<li><code>Jodd-props</code></li>
</ul><h2>
<a name="contributing%E8%B4%A1%E7%8C%AE" class="anchor" href="#contributing%E8%B4%A1%E7%8C%AE"><span class="octicon octicon-link"></span></a>Contributing(贡献)</h2>

<ul>
<li>国际化: 联系我</li>
<li>code &amp; doc: fork -&gt; pull requests</li>
<li>idea &amp; bug report: <a href="https://github.com/zqq90/webit-script/issues/new">github-issue</a>
</li>
<li>donate:</li>
</ul><h2>
<a name="license%E8%AE%B8%E5%8F%AF%E8%AF%81" class="anchor" href="#license%E8%AE%B8%E5%8F%AF%E8%AF%81"><span class="octicon octicon-link"></span></a>License(许可证)</h2>

<p><strong>Webit Script</strong> is released under the BSD License. See the bundled LICENSE file for
details.
<strong>Webit Script</strong> 依据 BSD许可证发布。详细请看捆绑的 LICENSE 文件。</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/zqq90/webit-script/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/zqq90/webit-script/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/zqq90/webit-script"></a> is maintained by <a href="https://github.com/zqq90">zqq90</a>.</p>

          <p>This page was generated by <a href="pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>